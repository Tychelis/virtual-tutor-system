<!DOCTYPE html>
<html>
<head>
    <title>è¯Šæ–­é¡µé¢</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #00ff00; }
        .info { margin: 10px 0; padding: 10px; background: #2d2d2d; border-left: 4px solid #00ff00; }
        .error { border-left-color: #ff0000; color: #ff6b6b; }
        .success { border-left-color: #00ff00; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>
    <h1>ğŸ” ç¼“å­˜è¯Šæ–­é¡µé¢</h1>
    
    <div id="results"></div>
    
    <button onclick="testFetch()">æµ‹è¯•fetch</button>
    <button onclick="clearAll()">æ¸…é™¤æ‰€æœ‰ç¼“å­˜</button>
    <button onclick="location.reload(true)">å¼ºåˆ¶é‡è½½</button>
    
    <script>
        const results = document.getElementById('results');
        
        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `info ${type}`;
            div.textContent = msg;
            results.appendChild(div);
        }
        
        // æ˜¾ç¤ºå½“å‰ç¯å¢ƒä¿¡æ¯
        log('æµè§ˆå™¨: ' + navigator.userAgent);
        log('å½“å‰URL: ' + window.location.href);
        log('Hostname: ' + window.location.hostname);
        
        // æ£€æŸ¥ç¼“å­˜
        if ('caches' in window) {
            caches.keys().then(keys => {
                log('ç¼“å­˜æ•°é‡: ' + keys.length + ' - ' + keys.join(', '));
            });
        }
        
        // æµ‹è¯•WebRTC URL
        const webrtcUrl = `http://${window.location.hostname}:8615/offer`;
        log('WebRTC URL: ' + webrtcUrl);
        
        async function testFetch() {
            try {
                log('æ­£åœ¨æµ‹è¯•fetchåˆ° ' + webrtcUrl + '...', 'info');
                const response = await fetch(webrtcUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        sdp: 'v=0\r\no=- 0 0 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0', 
                        type: 'offer' 
                    })
                });
                
                log(`âœ… å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, 'success');
                
                if (response.ok) {
                    const data = await response.json();
                    log('âœ… æ”¶åˆ°æ•°æ®: sessionid=' + data.sessionid, 'success');
                } else {
                    const text = await response.text();
                    log('âŒ é”™è¯¯å“åº”: ' + text, 'error');
                }
            } catch (error) {
                log('âŒ Fetchå¤±è´¥: ' + error.message, 'error');
            }
        }
        
        async function clearAll() {
            // æ¸…é™¤æ‰€æœ‰ç¼“å­˜
            if ('caches' in window) {
                const keys = await caches.keys();
                for (const key of keys) {
                    await caches.delete(key);
                    log('å·²åˆ é™¤ç¼“å­˜: ' + key);
                }
            }
            localStorage.clear();
            sessionStorage.clear();
            log('âœ… æ‰€æœ‰å­˜å‚¨å·²æ¸…é™¤', 'success');
        }
        
        // è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        setTimeout(testFetch, 1000);
    </script>
</body>
</html>
